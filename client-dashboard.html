<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const supabaseUrl = 'YOUR_SUPABASE_URL';
  const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  async function checkAuth() {
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) {
      window.location.href = 'login.html';
    }
  }

  checkAuth();
</script>

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Crown Trade Academy - Client Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Poppins:wght@300;500&display=swap" rel="stylesheet" />
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0;
    height: 100%;
    font-family: 'Poppins', sans-serif;
    background: #0a0a0a;
    color: #f5f1e9;
    overflow: hidden;
  }
  a {
    color: inherit;
    text-decoration: none;
  }
  button {
    cursor: pointer;
    font-family: inherit;
  }
  /* Splash Screen */
  #splash {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(135deg, #b8913f 0%, #6a4c12 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: #fff;
    font-weight: 600;
    font-size: 2.8rem;
    letter-spacing: 1.2px;
    z-index: 10000;
    opacity: 1;
    transition: opacity 1s ease;
  }
  #splash small {
    margin-top: 1rem;
    font-weight: 400;
    font-size: 1.3rem;
    opacity: 0.8;
  }

  /* Container */
  #app {
    display: flex;
    height: 100vh;
    opacity: 0;
    transition: opacity 0.8s ease 1s;
  }

  /* Sidebar */
  nav.sidebar {
    width: 250px;
    background: #1c1c1c;
    box-shadow: 2px 0 10px rgba(184, 145, 63, 0.3);
    display: flex;
    flex-direction: column;
    padding-top: 2rem;
  }
  nav.sidebar .logo {
    font-family: 'Montserrat', serif;
    font-weight: 700;
    font-size: 1.8rem;
    text-align: center;
    color: #b8913f;
    margin-bottom: 2.5rem;
    user-select: none;
    letter-spacing: 1.3px;
    text-shadow: 0 0 6px #b8913faa;
  }
  nav.sidebar ul {
    list-style: none;
    padding: 0;
    margin: 0;
    flex-grow: 1;
  }
  nav.sidebar ul li {
    margin-bottom: 1rem;
  }
  nav.sidebar ul li button {
    width: 100%;
    background: transparent;
    border: none;
    padding: 1rem 2rem;
    text-align: left;
    font-weight: 600;
    font-size: 1rem;
    color: #d6c79d;
    letter-spacing: 0.6px;
    border-left: 4px solid transparent;
    transition: background 0.3s, border-color 0.3s;
  }
  nav.sidebar ul li button.active,
  nav.sidebar ul li button:hover {
    background: #b8913f22;
    border-left: 4px solid #b8913f;
    color: #fff;
    box-shadow: 0 0 8px #b8913f88;
  }
  nav.sidebar ul li button:focus {
    outline: none;
  }
  nav.sidebar .logout-btn {
    margin: 2rem 1rem 1rem;
    padding: 1rem;
    background: #b82c2c;
    border-radius: 4px;
    font-weight: 600;
    color: #fff;
    text-align: center;
    letter-spacing: 0.8px;
    box-shadow: 0 0 8px #b82c2caa;
    border: none;
    transition: background 0.3s ease;
  }
  nav.sidebar .logout-btn:hover {
    background: #e04040;
  }

  /* Main content */
  main.content {
    flex-grow: 1;
    background: #121212;
    padding: 2rem 3rem;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: #b8913f55 transparent;
  }
  main.content::-webkit-scrollbar {
    width: 8px;
  }
  main.content::-webkit-scrollbar-thumb {
    background: #b8913f55;
    border-radius: 10px;
  }

  /* Section headings */
  h2 {
    font-family: 'Montserrat', serif;
    font-weight: 700;
    font-size: 2.2rem;
    color: #b8913f;
    margin-bottom: 1rem;
    text-shadow: 0 0 4px #b8913faa;
  }
  h3 {
    font-family: 'Montserrat', serif;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #d6c79d;
  }
  p {
    color: #ccc;
    line-height: 1.5;
  }

  /* Dashboard Overview */
  #dashboard-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    margin-top: 1rem;
  }
  .stat-card {
    background: #1f1f1f;
    border-left: 6px solid #b8913f;
    padding: 1.5rem;
    border-radius: 6px;
    box-shadow: 0 0 10px #b8913f33;
    text-align: center;
  }
  .stat-card .number {
    font-size: 2.5rem;
    font-weight: 700;
    color: #f0e6c8;
    margin-bottom: 0.4rem;
    letter-spacing: 1.2px;
  }
  .stat-card .label {
    font-weight: 500;
    text-transform: uppercase;
    color: #c1b57a;
    font-size: 0.85rem;
    letter-spacing: 1.5px;
  }

  /* Mentor Info */
  #mentor-info {
    background: #1f1f1f;
    margin-top: 3rem;
    border-radius: 6px;
    padding: 1.5rem 2rem;
    box-shadow: 0 0 15px #b8913f44;
    display: flex;
    align-items: center;
    gap: 1.8rem;
  }
  #mentor-info img {
    border-radius: 50%;
    width: 85px;
    height: 85px;
    border: 3px solid #b8913f;
    box-shadow: 0 0 10px #b8913f88;
    object-fit: cover;
  }
  #mentor-info div {
    flex-grow: 1;
  }
  #mentor-info h3 {
    margin: 0 0 0.3rem 0;
    color: #fff;
  }
  #mentor-info p {
    margin: 0;
    font-size: 0.9rem;
    color: #cfcab8;
  }

  /* Lessons Section */
  #lessons {
    margin-top: 2rem;
  }
  #lessons .lessons-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(260px,1fr));
    gap: 1.7rem;
  }
  .lesson-card {
    background: #1c1c1c;
    border-radius: 8px;
    padding: 1rem;
    box-shadow: 0 0 12px #b8913f44;
    display: flex;
    flex-direction: column;
    cursor: pointer;
    transition: box-shadow 0.3s ease;
  }
  .lesson-card:hover {
    box-shadow: 0 0 20px #b8913faa;
  }
  .lesson-thumb {
    width: 100%;
    border-radius: 6px;
    overflow: hidden;
    height: 140px;
    margin-bottom: 1rem;
    background-size: cover;
    background-position: center;
  }
  .lesson-title {
    font-weight: 600;
    color: #f0e6c8;
    margin-bottom: 0.2rem;
    font-size: 1.1rem;
  }
  .lesson-duration {
    font-size: 0.85rem;
    color: #cfcab8;
    margin-bottom: 0.8rem;
  }
  .progress-bar {
    height: 7px;
    background: #444;
    border-radius: 10px;
    overflow: hidden;
  }
  .progress-bar > div {
    height: 7px;
    background: #b8913f;
    width: 0%;
    border-radius: 10px;
    transition: width 0.6s ease;
  }
  .watch-btn {
    margin-top: auto;
    background: transparent;
    border: 1.7px solid #b8913f;
    padding: 0.5rem 0;
    font-weight: 600;
    color: #b8913f;
    border-radius: 5px;
    transition: background 0.3s ease, color 0.3s ease;
  }
  .watch-btn:hover {
    background: #b8913f;
    color: #0a0a0a;
  }

  /* Live Chart Section */
  #live-chart {
    margin-top: 2rem;
  }
  #chart-select {
    background: #1f1f1f;
    color: #b8913f;
    border: none;
    padding: 0.5rem 1rem;
    font-weight: 600;
    font-size: 1rem;
    border-radius: 6px;
    box-shadow: 0 0 8px #b8913f66 inset;
    margin-bottom: 1rem;
    cursor: pointer;
  }
  #tradingview-widget {
    border-radius: 10px;
    box-shadow: 0 0 20px #b8913f44;
    overflow: hidden;
  }

  /* Chat Section */
  #chat {
    margin-top: 2rem;
    background: #1c1c1c;
    border-radius: 8px;
    box-shadow: 0 0 15px #b8913f44;
    height: 450px;
    display: flex;
    flex-direction: column;
  }
  #chat-messages {
    flex-grow: 1;
    overflow-y: auto;
    padding: 1rem 1.5rem;
    color: #f5f1e9;
    font-size: 0.95rem;
  }
  .message {
    max-width: 70%;
    margin-bottom: 1rem;
    padding: 0.5rem 1rem;
    border-radius: 16px;
    line-height: 1.3;
  }
  .message.sent {
    background: #b8913f;
    color: #0a0a0a;
    align-self: flex-end;
    border-bottom-right-radius: 2px;
    box-shadow: 0 0 8px #b8913faa;
  }
  .message.received {
    background: #3e3e3e;
    color: #ddd;
    align-self: flex-start;
  }

  #typing-indicator {
    padding: 0.3rem 1.5rem;
    font-style: italic;
    color: #b8913f99;
    height: 22px;
  }

  #chat-input-container {
    display: flex;
    padding: 1rem 1.5rem;
    background: #121212;
    border-top: 1px solid #b8913f44;
  }
  #chat-input {
    flex-grow: 1;
    background: #1f1f1f;
    border: none;
    padding: 0.7rem 1rem;
    border-radius: 20px;
    color: #f5f1e9;
    font-size: 1rem;
    outline: none;
    transition: box-shadow 0.3s ease;
  }
  #chat-input:focus {
    box-shadow: 0 0 10px #b8913fbb;
  }
  #chat-send-btn {
    background: #b8913f;
    border: none;
    margin-left: 1rem;
    border-radius: 20px;
    color: #0a0a0a;
    padding: 0 1.5rem;
    font-weight: 700;
    font-size: 1rem;
    box-shadow: 0 0 8px #b8913faa;
    transition: background 0.3s ease;
  }
  #chat-send-btn:hover:not(:disabled) {
    background: #d0aa4b;
  }
  #chat-send-btn:disabled {
    background: #b8913f77;
    cursor: not-allowed;
  }

  /* Responsive */
  @media (max-width: 900px) {
    nav.sidebar {
      width: 60px;
      padding-top: 1rem;
    }
    nav.sidebar .logo {
      font-size: 1.2rem;
      margin-bottom: 1rem;
      white-space: nowrap;
    }
    nav.sidebar ul li button {
      padding: 1rem 0.5rem;
      font-size: 0;
      position: relative;
    }
    nav.sidebar ul li button::after {
      content: attr(data-label);
      position: absolute;
      left: 100%;
      top: 50%;
      transform: translateY(-50%);
      white-space: nowrap;
      background: #b8913fdd;
      color: #0a0a0a;
      padding: 0.2rem 0.5rem;
      font-weight: 600;
      border-radius: 4px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      font-size: 0.85rem;
      letter-spacing: 0.8px;
      z-index: 100;
    }
    nav.sidebar ul li button:hover::after {
      opacity: 1;
    }
    main.content {
      padding: 1rem;
    }
  }
</style>
</head>
<body>
  <div id="splash">
    Welcome to Crown Trade Academy
    <small id="username-placeholder">Trader</small>
  </div>
  <div id="app" aria-live="polite" aria-atomic="true">
    <nav class="sidebar" role="navigation" aria-label="Main Navigation">
      <div class="logo">CrownTrade</div>
      <ul>
        <li><button class="nav-btn active" data-target="dashboard-overview" data-label="Dashboard" aria-current="page">Dashboard</button></li>
        <li><button class="nav-btn" data-target="lessons" data-label="Lessons">Lessons</button></li>
        <li><button class="nav-btn" data-target="live-chart" data-label="Live Chart">Live Chart</button></li>
        <li><button class="nav-btn" data-target="chat" data-label="Chat">Chat</button></li>
      </ul>
      <button class="logout-btn" aria-label="Logout">Logout</button>
    </nav>

    <main class="content">
      <!-- Dashboard Overview -->
      <section id="dashboard-overview" role="region" aria-labelledby="dashboard-heading">
        <h2 id="dashboard-heading">Dashboard Overview</h2>
        <div id="stats-cards" class="stat-cards">
          <div class="stat-card" tabindex="0" aria-label="Lessons Completed">
            <div class="number" id="lessons-completed">0</div>
            <div class="label">Lessons Completed</div>
          </div>
          <div class="stat-card" tabindex="0" aria-label="Trading Progress">
            <div class="number" id="trading-progress">0%</div>
            <div class="label">Trading Progress</div>
          </div>
          <div class="stat-card" tabindex="0" aria-label="Mentor Name">
            <div class="number" id="mentor-name">-</div>
            <div class="label">Mentor</div>
          </div>
        </div>

        <div id="mentor-info" tabindex="0" aria-label="Mentor Information">
          <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Mentor profile picture" />
          <div>
            <h3 id="mentor-fullname">John Doe</h3>
            <p>Professional Trader & Coach</p>
            <p>Available for one-on-one sessions and live market analysis.</p>
          </div>
        </div>
      </section>

      <!-- Lessons Section -->
      <section id="lessons" hidden role="region" aria-labelledby="lessons-heading">
        <h2 id="lessons-heading">Your Lessons</h2>
        <div class="lessons-grid" id="lessons-grid" tabindex="0" aria-live="polite">
          <!-- dynamically generated lessons will appear here -->
        </div>
      </section>

      <!-- Live Chart Section -->
      <section id="live-chart" hidden role="region" aria-labelledby="chart-heading">
        <h2 id="chart-heading">Live Market Chart</h2>
        <select id="chart-select" aria-label="Select trading symbol">
          <option value="XAUUSD">Gold (XAUUSD)</option>
          <option value="EURUSD">EUR/USD</option>
          <option value="BTCUSD">Bitcoin (BTCUSD)</option>
        </select>
        <div id="tradingview-widget"></div>
      </section>

      <!-- Chat Section -->
      <section id="chat" hidden role="region" aria-labelledby="chat-heading">
        <h2 id="chat-heading">Mentor Chat</h2>
        <div id="chat-messages" role="log" aria-live="polite" aria-relevant="additions"></div>
        <div id="typing-indicator" aria-live="polite" aria-atomic="true" hidden></div>
        <div id="chat-input-container">
          <input type="text" id="chat-input" aria-label="Type your message" autocomplete="off" />
          <button id="chat-send-btn" aria-label="Send message" disabled>Send</button>
        </div>
      </section>
    </main>
  </div>

<script src="https://unpkg.com/lightweight-charts@3.7.0/dist/lightweight-charts.standalone.production.js"></script>
<script src="https://s3.tradingview.com/tv.js"></script>
<script>
  // Splash and app show
  const splash = document.getElementById('splash');
  const app = document.getElementById('app');
  // Simulate fetching username
  const username = "Elite Trader";
  document.getElementById('username-placeholder').textContent = username;

  setTimeout(() => {
    splash.style.opacity = '0';
    setTimeout(() => splash.style.display = 'none', 1000);
    app.style.opacity = '1';
  }, 2500);

  // Navigation buttons and content toggle
  const navButtons = document.querySelectorAll('nav.sidebar .nav-btn');
  const sections = ['dashboard-overview', 'lessons', 'live-chart', 'chat'];
  navButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      // Set active btn
      navButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      // Show corresponding section
      sections.forEach(id => {
        document.getElementById(id).hidden = id !== btn.dataset.target;
      });
    });
  });

  // Logout button
  document.querySelector('.logout-btn').addEventListener('click', () => {
    alert('Logging out...');
    // Here add actual logout logic e.g. clear session/localstorage, redirect to login page etc.
    location.reload();
  });

  // Lessons data sample
  const lessonsData = [
    {
      title: "Introduction to Trading",
      duration: "25 min",
      thumbnail: "https://i.imgur.com/AzNMeGU.jpg",
      progress: 80,
    },
    {
      title: "Understanding Candlestick Patterns",
      duration: "40 min",
      thumbnail: "https://i.imgur.com/9k2gqL9.jpg",
      progress: 45,
    },
    {
      title: "Liquidity & Order Blocks",
      duration: "30 min",
      thumbnail: "https://i.imgur.com/6YNkFhz.jpg",
      progress: 10,
    },
    {
      title: "Risk Management Mastery",
      duration: "50 min",
      thumbnail: "https://i.imgur.com/Lj9knqp.jpg",
      progress: 0,
    },
    {
      title: "Live Trading Strategies",
      duration: "60 min",
      thumbnail: "https://i.imgur.com/kFec5wW.jpg",
      progress: 0,
    },
  ];

  // Render lessons cards
  const lessonsGrid = document.getElementById('lessons-grid');
  function renderLessons() {
    lessonsGrid.innerHTML = '';
    lessonsData.forEach((lesson, i) => {
      const card = document.createElement('div');
      card.className = 'lesson-card';
      card.tabIndex = 0;
      card.innerHTML = `
        <div class="lesson-thumb" style="background-image:url('${lesson.thumbnail}')"></div>
        <div class="lesson-title">${lesson.title}</div>
        <div class="lesson-duration">${lesson.duration}</div>
        <div class="progress-bar"><div style="width:${lesson.progress}%;"></div></div>
        <button class="watch-btn" aria-label="Watch ${lesson.title}">Watch</button>
      `;
      // Example event for "Watch" button
      card.querySelector('.watch-btn').addEventListener('click', () => {
        alert(`Starting lesson: "${lesson.title}"`);
      });
      lessonsGrid.appendChild(card);
    });
  }
  renderLessons();

  // Dashboard stats update
  document.getElementById('lessons-completed').textContent = lessonsData.filter(l => l.progress === 100).length;
  const tradingProgress = Math.round(lessonsData.reduce((sum, l) => sum + l.progress, 0) / lessonsData.length);
  document.getElementById('trading-progress').textContent = tradingProgress + '%';
  document.getElementById('mentor-name').textContent = 'John Doe';

  // TradingView Widget
  let currentSymbol = 'XAUUSD';
  const widgetContainer = document.getElementById('tradingview-widget');
  const chartSelect = document.getElementById('chart-select');

  function createTradingViewWidget(symbol) {
    widgetContainer.innerHTML = '';
    new TradingView.widget({
      width: '100%',
      height: 450,
      symbol: symbol,
      interval: '60',
      timezone: 'Etc/UTC',
      theme: 'dark',
      style: '1',
      locale: 'en',
      toolbar_bg: '#1c1c1c',
      enable_publishing: false,
      hide_top_toolbar: true,
      hide_legend: true,
      allow_symbol_change: false,
      container_id: 'tradingview-widget'
    });
  }
  createTradingViewWidget(currentSymbol);

  chartSelect.addEventListener('change', (e) => {
    currentSymbol = e.target.value;
    createTradingViewWidget(currentSymbol);
  });

  // Simple Chat Simulation with typing animation
  const chatMessages = document.getElementById('chat-messages');
  const chatInput = document.getElementById('chat-input');
  const chatSendBtn = document.getElementById('chat-send-btn');
  const typingIndicator = document.getElementById('typing-indicator');

  chatInput.addEventListener('input', () => {
    chatSendBtn.disabled = !chatInput.value.trim();
  });

  function appendMessage(text, sent = true) {
    const msgDiv = document.createElement('div');
    msgDiv.classList.add('message');
    msgDiv.classList.add(sent ? 'sent' : 'received');
    msgDiv.textContent = text;
    chatMessages.appendChild(msgDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function simulateMentorReply() {
    typingIndicator.hidden = false;
    typingIndicator.textContent = 'Mentor is typing...';
    setTimeout(() => {
      typingIndicator.hidden = true;
      appendMessage("Thanks for your message! We'll get back to you shortly.", false);
    }, 2000);
  }

  chatSendBtn.addEventListener('click', () => {
    const text = chatInput.value.trim();
    if (!text) return;
    appendMessage(text, true);
    chatInput.value = '';
    chatSendBtn.disabled = true;
    simulateMentorReply();
  });

</script>
</body>
</html>
