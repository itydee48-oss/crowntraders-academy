<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crown Trade — Mentor Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --nude: #F9F6F2; --gold:#C8A97E; --gold-dark:#B89463; --charcoal:#2e2e2e;
      --muted:#777; --success:#10B981; --warning:#F59E0B; --danger:#EF4444; --info:#3B82F6;
    }
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Montserrat',sans-serif;background:var(--nude);color:var(--charcoal);min-height:100vh;}
    .mentor-app{display:grid;grid-template-columns:280px 1fr;gap:24px;padding:24px;height:100vh;}
    .sidebar{background:rgba(255,255,255,0.95);border:1px solid rgba(200,169,126,0.4);border-radius:16px;padding:30px;box-shadow:0 20px 60px rgba(0,0,0,0.06);}
    .brand{font-family:'Cormorant Garamond',serif;font-size:2.4rem;color:var(--gold-dark);margin-bottom:8px;}
    .nav button{width:100%;padding:14px 18px;margin:8px 0;border:none;border-radius:12px;background:transparent;color:var(--charcoal);font-weight:600;text-align:left;cursor:pointer;transition:.3s;}
    .nav button:hover,.nav button.active{background:var(--gold);color:white;}
    .main-content{background:rgba(255,255,255,0.95);border-radius:16px;padding:30px;overflow:auto;border:1px solid rgba(200,169,126,0.3);}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid var(--nude);}
    .title{font-family:'Cormorant Garamond',serif;font-size:2.2rem;color:var(--gold-dark);}
    .card{background:white;padding:24px;border-radius:14px;margin-bottom:20px;box-shadow:0 10px 30px rgba(0,0,0,0.05);border:1px solid #eee;}
    .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
    .card-title{font-size:1.4rem;color:var(--gold-dark);font-weight:600;}
    .table{width:100%;border-collapse:collapse;}
    .table th,.table td{padding:12px;text-align:left;border-bottom:1px solid #eee;}
    .table th{background:var(--nude);font-weight:600;color:var(--charcoal);}
    .btn{background:var(--gold);color:white;border:none;padding:10px 16px;border-radius:8px;cursor:pointer;font-weight:600;margin:2px;font-size:0.9rem;transition:.3s;}
    .btn:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,0.15);}
    .btn-success{background:var(--success);}
    .btn-info{background:var(--info);}
    .btn-danger{background:var(--danger);}

    /* CHAT STYLES */
    .chat-container{
      position:fixed;bottom:20px;right:20px;width:380px;height:520px;
      background:white;border-radius:18px;box-shadow:0 20px 60px rgba(0,0,0,0.2);
      display:none;flex-direction:column;z-index:9999;border:1px solid rgba(200,169,126,0.4);
    }
    .chat-header{
      background:var(--gold-dark);color:white;padding:16px;border-radius:18px 18px 0 0;
      font-weight:600;display:flex;justify-content:space-between;align-items:center;
    }
    .chat-body{flex:1;overflow-y:auto;padding:16px;background:#f8f8f8;}
    .chat-message{
      margin-bottom:12px;max-width:80%;padding:10px 14px;border-radius:18px;
      word-wrap:break-word;font-size:0.95rem;line-height:1.4;
    }
    .chat-message.own{
      background:var(--gold);color:white;align-self:flex-end;margin-left:auto;border-bottom-right-radius:4px;
    }
    .chat-message.other{
      background:#e5e7eb;color:#111;align-self:flex-start;border-bottom-left-radius:4px;
    }
    .chat-message-meta{
      font-size:0.75rem;opacity:0.8;margin-top:4px;
    }
    .chat-input-area{
      padding:12px;background:white;border-top:1px solid #eee;display:flex;gap:10px;
    }
    .chat-input{
      flex:1;padding:12px;border-radius:30px;border:1px solid #ddd;font-size:0.95rem;
    }
    .chat-input:focus{outline:none;border-color:var(--gold);}
    .send-btn{
      width:44px;height:44px;border-radius:50%;background:var(--gold);color:white;
      display:flex;align-items:center;justify-content:center;cursor:pointer;
    }
    .floating-chat-btn{
      position:fixed;bottom:30px;right:30px;width:60px;height:60px;
      background:var(--gold-dark);color:white;border-radius:50%;box-shadow:0 10px 30px rgba(0,0,0,0.3);
      display:flex;align-items:center;justify-content:center;font-size:1.8rem;cursor:pointer;z-index:1000;
    }

    .client-details{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:1000;justify-content:center;align-items:center;}
    .client-modal{background:white;padding:30px;border-radius:16px;max-width:900px;width:95%;max-height:90vh;overflow-y:auto;box-shadow:0 30px 100px rgba(0,0,0,0.3);}
    .close-modal{position:absolute;top:15px;right:20px;background:var(--danger);color:white;border:none;border-radius:50%;width:40px;height:40px;font-size:22px;cursor:pointer;}
    .tabs{display:flex;border-bottom:1px solid #eee;margin-bottom:20px;gap:20px;}
    .tab{padding:12px 0;cursor:pointer;border-bottom:3px solid transparent;font-weight:600;}
    .tab.active{border-bottom:3px solid var(--gold);color:var(--gold-dark);}
    .tab-content{display:none;}
    .tab-content.active{display:block;}
    .notification{position:fixed;top:20px;right:20px;padding:16px 24px;border-radius:10px;color:white;font-weight:600;z-index:10000;animation:slideIn .4s;box-shadow:0 10px 30px rgba(0,0,0,0.3);}
    .notification.success{background:var(--success);}
    .notification.error{background:var(--danger);)}
    @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
    @media(max-width:1000px){.mentor-app{grid-template-columns:1fr}.chat-container{width:100%;height:100%;border-radius:0;right:0;bottom:0;}}
  </style>
</head>
<body>

<!-- Floating Chat Button -->
<div class="floating-chat-btn" onclick="toggleChat()">Chat</div>

<!-- Community Chat -->
<div class="chat-container" id="chatBox">
  <div class="chat-header">
    <div>Crown Trade Community</div>
    <button style="background:none;border:none;color:white;font-size:1.4rem;cursor:pointer;" onclick="toggleChat()">×</button>
  </div>
  <div class="chat-body" id="chatBody"></div>
  <div class="chat-input-area">
    <input type="text" class="chat-input" id="chatInput" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendMessage()">
    <div class="send-btn" onclick="sendMessage()">Send</div>
  </div>
</div>

<div class="mentor-app">
  <aside class="sidebar">
    <div class="brand">Crown Trade</div>
    <div class="mentor-info">
      <div style="font-weight:700">Elite Mentor</div>
      <div style="color:var(--muted)">Community Portal</div>
    </div>
    <nav class="nav">
      <button data-tab="clients" class="active">All Clients</button>
      <button data-tab="lessons">Lessons Library</button>
      <button data-tab="resources">Resources</button>
      <button data-tab="sessions">Sessions</button>
      <button data-tab="chat" onclick="openChatTab()">Community Chat</button>
    </nav>
    <button class="btn" style="margin-top:auto;width:100%;background:var(--info);" onclick="loadAll()">Refresh All</button>
  </aside>

  <main class="main-content">
    <div class="topbar">
      <div class="title">Mentor Command Center</div>
      <div style="text-align:right">
        <div style="font-weight:700">Crown Mentors</div>
        <small>Approved clients: <span id="clientsCount">0</span></small>
      </div>
    </div>

    <!-- Clients Tab -->
    <div id="clients">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Approved Clients</div>
          <button class="btn btn-info" onclick="loadClients()">Refresh</button>
        </div>
        <table class="table">
          <thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Program</th><th>Joined</th><th>Action</th></tr></thead>
          <tbody id="clientsTable"><tr><td colspan="6">Loading...</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- Other tabs (lessons, resources, sessions) stay the same -->
    <div id="lessons" style="display:none">...</div>
    <div id="resources" style="display:none">...</div>
    <div id="sessions" style="display:none">...</div>
  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // === SUPABASE SETUP (USE YOUR REAL PROJECT) ===
  const supabase = window.supabase.createClient(
    'https://eygjxxdgxzatchqgwvep.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5Z2p4eGRneHphdGNocWd3dmVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzODUyODIsImV4cCI6MjA3Nzk2MTI4Mn0.USOvTWBQ_kW-ty5XkTehYmPJKXeD2_hGGGM40G55tqg'
  );

  const mentorName = "Mentor"; // In real app, get from login

  // === COMMUNITY CHAT SYSTEM ===
  async function loadChat() {
    const { data } = await supabase
      .from('community_chat')
      .select('*')
      .order('created_at', { ascending: true });

    const chatBody.innerHTML = '';
    data?.forEach(msg => addMessageToChat(msg));
  }

  function addMessageToChat(msg) {
    const div = document.createElement('div');
    div.className = `chat-message ${msg.sender === mentorName ? 'own' : 'other'}`;
    div.innerHTML = `
      <strong>${msg.sender}</strong><br>
      ${msg.message}
      <div class="chat-message-meta">${new Date(msg.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
    `;
    chatBody.appendChild(div);
    chatBody.scrollTop = chatBody.scrollHeight;
  }

  async function sendMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    if (!message) return;

    const { error } = await supabase
      .from('community_chat')
      .insert({ sender: mentorName, message });

    if (error) {
      alert('Message failed');
    } else {
      input.value = '';
    }
  }

  // Realtime listener
  supabase
    .channel('public:community_chat')
    .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'community_chat' }, payload => {
      addMessageToChat(payload.new);
    })
    .subscribe();

  function toggleChat() {
    const chat = document.getElementById('chatBox');
    if (chat.style.display === 'flex') {
      chat.style.display = 'none';
    } else {
      chat.style.display = 'flex';
      loadChat();
    }
  }

  function openChatTab() {
    toggleChat();
  }

  // === REST OF YOUR DASHBOARD (Clients, Lessons, etc.) ===
  async function loadClients() {
    const { data, error } = await supabase
      .from('clients')
      .select('*')
      .eq('status', 'approved')
      .order('join_date', { ascending: false });

    if (error) { console.error(error); return; }

    document.getElementById('clientsCount').textContent = data.length;
    document.getElementById('clientsTable').innerHTML = data.map(c => `
      <tr style="cursor:pointer" onclick="viewClient('${c.id}')">
        <td><strong>${c.name}</strong></td>
        <td>${c.email}</td>
        <td>${c.phone}</td>
        <td>${c.program}</td>
        <td>${new Date(c.join_date).toLocaleDateString()}</td>
        <td><button class="btn btn-info" onclick="event.stopPropagation();viewClient('${c.id}')">View</button></td>
      </tr>
    `).join('') || '<tr><td colspan="6">No clients yet</td></tr>';
  }

  function viewClient(id) {
    alert('Client details modal opens here — your existing code goes here');
    // Keep your full client modal code here
  }

  function loadAll() {
    loadClients();
    showNotification('Dashboard refreshed!');
  }

  function showNotification(msg, type='success') {
    const n = document.createElement('div');
    n.className = `notification ${type}`;
    n.textContent = msg;
    document.body.appendChild(n);
    setTimeout(() => n.remove(), 3000);
  }

  // Sidebar navigation
  document.querySelectorAll('.nav button[data-tab]').forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('#clients,#lessons,#resources,#sessions').forEach(t => t.style.display='none');
      document.getElementById(btn.dataset.tab).style.display = 'block';
    }
  });

  // Load on start
  loadClients();
  showNotification('Welcome to Crown Trade Mentor Portal!');
</script>
</body>
</html>
