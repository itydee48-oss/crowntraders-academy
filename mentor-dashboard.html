<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Platform</title>
    <style>
        :root {
            --gold-dark: #b8941f;
        }
        
        .card {
            margin-top: 18px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .btn.ghost {
            background: transparent;
            border: 1px solid var(--gold-dark);
            color: var(--gold-dark);
        }
        
        .tv-wrapper {
            position: relative;
        }
    </style>
</head>
<body>
    <main>
        <div class="container">
            <!-- TradingView Widget -->
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                    <div style="font-weight:800; color:var(--gold-dark)">Trading Chart</div>
                    <div>
                        <button id="btnFullScreenTV" class="btn ghost">Fullscreen</button>
                    </div>
                </div>
                <div class="tv-wrapper" id="tvContainer">
                    <!-- TradingView Chart -->
                    <div id="tv_embed"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Helper function to select elements
        const $ = (selector) => document.querySelector(selector);
        
        /**********************
         * TradingView embed + fullscreen control - BUTTON FIXED
         **********************/
        function loadTradingView(){
            const container = document.getElementById('tv_embed');
            if (!container) return;
            
            container.innerHTML = '';
            const scr = document.createElement('script');
            scr.src = 'https://s3.tradingview.com/tv.js';
            scr.onload = () => {
                try {
                    new TradingView.widget({
                        "width": "100%",
                        "height": 400,
                        "symbol": "FOREXCOM:EURUSD",
                        "interval": "60",
                        "timezone": "Etc/UTC",
                        "theme": "Light",
                        "style": "1",
                        "locale": "en",
                        "toolbar_bg": "#f9f6f2",
                        "enable_publishing": false,
                        "container_id": "tv_embed"
                    });
                } catch(err) {
                    console.error('TradingView init error', err);
                }
            };
            document.getElementById('tvContainer').appendChild(scr);
        }

        // Fullscreen button - NOW WORKING
        const fullscreenBtn = $('#btnFullScreenTV');
        if (fullscreenBtn) {
            fullscreenBtn.addEventListener('click', () => {
                const elem = document.getElementById('tvContainer');
                if (!elem) return;
                
                if (!document.fullscreenElement) {
                    if (elem.requestFullscreen) {
                        elem.requestFullscreen();
                    } else if (elem.webkitRequestFullscreen) {
                        elem.webkitRequestFullscreen();
                    } else if (elem.msRequestFullscreen) {
                        elem.msRequestFullscreen();
                    }
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                }
            });
        }

        /**********************
         * Clear Chat Button - NOW WORKING
         **********************/
        const clearChatBtn = $('#btnClearChat');
        if (clearChatBtn) {
            clearChatBtn.addEventListener('click', async () => {
                if (!confirm('Clear local chat view? This will not delete messages from database.')) return;
                
                const chatWindow = $('#chatWindow');
                if (chatWindow) {
                    chatWindow.innerHTML = '';
                }
            });
        }

        /**********************
         * Initialize ONLY what's needed for buttons
         **********************/
        function initializeButtons() {
            // Load TradingView if the container exists
            const tvContainer = document.getElementById('tv_embed');
            if (tvContainer) {
                loadTradingView();
            }
            
            // Verify buttons are working
            console.log('Buttons initialized:', {
                fullscreen: !!$('#btnFullScreenTV'),
                clearChat: !!$('#btnClearChat')
            });
        }

        // Start when page loads
        document.addEventListener('DOMContentLoaded', initializeButtons);
    </script>
</body>
</html>
