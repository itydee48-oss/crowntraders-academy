<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crown Trade Academy — Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{--nude:#F9F6F2;--gold:#C8A97E;--gold-dark:#B89463;--charcoal:#2e2e2e;}
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Montserrat',sans-serif;background:linear-gradient(135deg,var(--nude),#fff);color:var(--charcoal);min-height:100vh;display:flex;align-items:center;justify-content:center;}
    .login-box{max-width:440px;width:100%;background:rgba(255,255,255,0.95);padding:60px 50px;border-radius:20px;box-shadow:0 30px 80px rgba(0,0,0,0.1);border:1px solid rgba(200,169,126,0.4);text-align:center;}
    .logo img{width:130px;height:130px;border-radius:50%;border:6px solid var(--gold);margin-bottom:20px;}
    .brand{font-family:'Cormorant Garamond',serif;font-size:2.8rem;color:var(--gold-dark);margin-bottom:8px;letter-spacing:1px;}
    .tagline{font-size:1.1rem;color:var(--charcoal);margin-bottom:40px;}
    input{width:100%;padding:18px 20px;margin:14px 0;border-radius:14px;border:1px solid rgba(0,0,0,0.12);font-size:1.05rem;transition:0.3s;}
    input:focus{outline:none;border-color:var(--gold);box-shadow:0 0 0 4px rgba(200,169,126,0.25);}
    .btn{background:var(--gold);color:white;border:none;padding:18px;width:100%;border-radius:14px;font-weight:700;font-size:1.15rem;cursor:pointer;margin-top:20px;transition:0.3s;}
    .btn:hover{background:var(--gold-dark);}
    .switch{margin-top:30px;font-size:0.95rem;}
    .switch a{color:var(--gold-dark);font-weight:600;text-decoration:none;}
    .msg{margin-top:20px;color:#d32f2f;font-weight:600;min-height:24px;}
  </style>
</head>
<body>

<div class="login-box">
  <div class="logo">
    <img src="https://i.imgur.com/8QjW9jF.jpeg" alt="Crown Trade">
  </div>
  <div class="brand">Crown Trade</div>
  <div class="tagline">Luxury Trading Education • Mentor & Client Portal</div>

  <form id="loginForm">
    <input type="email" id="email" placeholder="Email address" required>
    <input type="password" id="password" placeholder="Password" required>
    <button type="submit" class="btn">Login</button>
  </form>

  <div class="switch">
    New here? <a href="#" id="showRegister">Create account</a>
  </div>

  <div id="msg" class="msg"></div>
</div>

<script>
  const SUPABASE_URL = 'https://eygjxxdgxzatchqgwvep.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInRlZiI6ImV5Z2p4eGRneHphdGNoUWd3dmVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzODUyODIsImV4cCI6MjA3Nzk2MTI4Mn0.USOvTWBQ_kW-ty5XkTehYmPJKXeD2_hGGGM40G55tqg';

  document.getElementById('loginForm').onsubmit = async (e) => {
    e.preventDefault();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    const msg = document.getElementById('msg');
    msg.textContent = 'Logging in...';

    try {
      const res = await fetch(`${SUPABASE_URL}/auth/v1/token?grant_type=password`, {
        method: 'POST',
        headers: { apikey: SUPABASE_KEY, 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });

      if (!res.ok) throw await res.json();

      const { access_token, user } = await res.json();

      // Get profile to know role
      const profileRes = await fetch(`${SUPABASE_URL}/rest/v1/profiles?id=eq.${user.id}&select=role`, {
        headers: { apikey: SUPABASE_KEY }
      });
      const [profile] = await profileRes.json() || [{}];

      // Redirect based on role
      if (profile.role === 'mentor') {
        location.href = 'mentor-dashboard.html';
      } else if (profile.role === 'client') {
        location.href = 'client-dashboard.html';  // we'll build this next
      } else {
        msg.textContent = 'Role not recognized. Contact admin.';
      }
    } catch (err) {
      msg.textContent = err.error_description || 'Invalid email or password';
    }
  };

  // Quick register (creates client by default)
  document.getElementById('showRegister').onclick = (e) => {
    e.preventDefault();
    const email = prompt('Enter your email:');
    const pass = prompt('Choose a password:');
    if (email && pass) {
      fetch(`${SUPABASE_URL}/auth/v1/signup`, {
        method: 'POST',
        headers: { apikey: SUPABASE_KEY, 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password: pass })
      })
      .then(r => r.json())
      .then(data => {
        if (data.user) {
          alert('Account created! Check your email to confirm, then log in.');
        } else {
          alert('Error: ' + JSON.stringify(data));
        }
      });
    }
  };
</script>
</body>
</html>
