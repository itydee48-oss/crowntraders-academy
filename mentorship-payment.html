<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mentorship Payment</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .card {
      background: #020617;
      padding: 24px;
      border-radius: 10px;
      width: 360px;
      text-align: center;
      box-shadow: 0 0 20px rgba(0,0,0,.5);
    }
    button {
      margin-top: 16px;
      width: 100%;
      padding: 12px;
      background: #22c55e;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }
    .error {
      color: #f87171;
      margin-top: 12px;
    }
  </style>
</head>
<body>

<div class="card">
  <h2>Mentorship Payment</h2>
  <p id="status">Checking registrationâ€¦</p>
  <button id="payBtn" disabled>Proceed to Pay</button>
  <p class="error" id="error"></p>
</div>

<script>
  const supabase = window.supabase.createClient(
    "YOUR_SUPABASE_URL",
    "YOUR_SUPABASE_ANON_KEY"
  );

  const registrationId = sessionStorage.getItem("registration_id");

  const statusEl = document.getElementById("status");
  const errorEl = document.getElementById("error");
  const payBtn = document.getElementById("payBtn");

  async function init() {
    // ðŸš¨ HARD BLOCK â€” payment page should NEVER load without this
    if (!registrationId) {
      window.location.replace("mentorship-login.html");
      return;
    }

    const { data, error } = await supabase
      .from("registrations")
      .select("id, status")
      .eq("id", registrationId)
      .single();

    if (error || !data) {
      sessionStorage.removeItem("registration_id");
      window.location.replace("mentorship-login.html");
      return;
    }

    statusEl.textContent = "Registration verified";
    payBtn.disabled = false;

    payBtn.onclick = async () => {
      payBtn.disabled = true;
      statusEl.textContent = "Processingâ€¦";

      const { error: updateError } = await supabase
        .from("registrations")
        .update({ payment_status: "initiated" })
        .eq("id", registrationId);

      if (updateError) {
        errorEl.textContent = "Payment initialization failed";
        payBtn.disabled = false;
        return;
      }

      // ðŸ‘‰ Replace with real payment gateway redirect
      alert("Redirect to payment gateway here");
    };
  }

  init();
</script>

</body>
</html>
